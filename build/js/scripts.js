angular.module("app.controllers",[]).controller("appCtrl",["$rootScope","$timeout",function(a,b){a.addAlert=function(c){var d=!0;_.forEach(a.alerts,function(a){return a.message===c.message?d=!1:void 0}),d&&(a.alerts.push(c),"success"===c.type&&b(function(){_.pull(a.alerts,c)},3e3))},a.closeAlert=function(b){a.alerts.splice(b,1)},a.removeAlerts=function(){a.alerts=[]}}]),angular.module("app.directives",[]).directive("activityIndicator",function(){return{replace:!0,templateUrl:"app/partials/activityIndicator.html"}}),angular.module("app",["ngAnimate","ui.bootstrap","ui.router","jm.i18next","app.controllers","app.services","app.directives","businessSetup","ngActivityIndicator"]).config(["$stateProvider",function(a){a.state("home",{url:"/"})}]).config(["$i18nextProvider",function(a){a.options={lng:"en",fallbackLng:"en",ns:{namespaces:["app","businessSetup"],defaultNs:"app"},resGetPath:"modules/__ns__/i18n/__lng__/__ns__.json",defaultLoadingValue:""}}]).run(["$rootScope","$state","$stateParams","editableOptions",function(a,b,c,d){a.$state=c,a.$stateParams=b,a.alerts=[],d.theme="bs3"}]),angular.module("app.services",[]).factory("coachSeekAPIService",["$http","$q","$timeout",function(a,b,c){var d={};return d.getBusiness=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve({})},_.random(500,600)),this.deferred.promise},d.saveBusiness=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve([])},_.random(500,600)),this.deferred.promise},d.createBusiness=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve({business:{name:"West Coast Toast"},admin:{firstName:"Toast",lastName:"Master",email:"toastmaster@westcoasttoast.com",password:"password"}})},_.random(500,600)),this.deferred.promise},d.getLocations=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve([])},_.random(500,600)),this.deferred.promise},d.createLocation=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve({businessId:"8786bcd0-3b14-4f7b-92db-198527a5b949",id:null,name:"THE LAB",address:"1800 taylor ave n",city:"Seattle",state:"WA",country:"USA"})},_.random(500,800)),this.deferred.promise},d.saveLocation=function(){var a=b.defer();return a.resolve("DATA"),a.promise},d.getServices=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve([])},_.random(500,600)),this.deferred.promise},d.createService=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve({businessId:"8786bcd0-3b14-4f7b-92db-198527a5b949",id:null,name:"Toast Making",description:"I show you how to make goddamn toast, son.",timing:{duration:"0:15"},booking:{studentCapacity:8},presentation:{color:"blue"},repititon:{sessionCount:12,repeatFrequency:"w"},pricing:{sessionPrice:15,coursePrice:150}})},_.random(500,800)),this.deferred.promise},d.saveService=function(){var a=b.defer();return a.resolve("DATA"),a.promise},d.getCoaches=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve({})},_.random(500,1500)),this.deferred.promise},d.saveCoach=function(){var a=b.defer();return a.resolve("DATA"),a.promise},d.createCoach=function(){var a=b.defer();return a.resolve({businessId:"8786bcd0-3b14-4f7b-92db-198527a5b949",id:null,firstName:"Toast",lastName:"Apprentice #1",email:"apprentice@westcoasttoast.com",phone:"021 99 88 77",workingHours:{monday:{isAvailable:!0,startTime:"9:00",finishTime:"17:00"},tuesday:{isAvailable:!0,startTime:"9:00",finishTime:"17:00"},wednesday:{isAvailable:!0,startTime:"9:00",finishTime:"17:00"},thursday:{isAvailable:!0,startTime:"9:00",finishTime:"17:00"},friday:{isAvailable:!0,startTime:"9:00",finishTime:"17:00"},saturday:{isAvailable:!1,startTime:"9:00",finishTime:"17:00"},sunday:{isAvailable:!1,startTime:"9:00",finishTime:"17:00"}}}),a.promise},d}]),describe("App Module",function(){it("should set $rootScope.alerts to an empty array",function(){expect($rootScope.alerts).to.be.empty}),describe("global alert system",function(){beforeEach(function(){this.let("alertOne",function(){return{type:"success",message:"alert one"}}),this.let("alertTwo",function(){return{type:"warning",message:"alert two"}}),this.let("alertThree",function(){return{type:"error",message:"alert three"}}),$rootScope.addAlert(this.alertOne),$rootScope.addAlert(this.alertTwo),$rootScope.addAlert(this.alertThree)}),describe("when calling addAlert() with new alerts",function(){it("should set them on the $rootScope",function(){expect($rootScope.alerts.length).to.equal(3)})}),describe("when calling addAlert() with existing alerts",function(){it("should not add them to alerts",function(){$rootScope.addAlert(this.alertOne),expect($rootScope.alerts.length).to.equal(3)})}),describe("when calling closeAlert(index)",function(){it("should remove the correct alert",function(){$rootScope.closeAlert(1),expect(_.contains($rootScope.alerts,this.alertOne)).to.be["true"],expect(_.contains($rootScope.alerts,this.alertThree)).to.be["true"]})}),describe("when calling removeAlerts()",function(){it("should erase all alerts from $rootScope",function(){$rootScope.removeAlerts(),expect($rootScope.alerts).to.be.empty})}),describe("when adding a success alert",function(){it("should disappear after 3 seconds",function(){$timeout.flush(),expect(_.contains($rootScope.alerts,this.alertOne)).to.be["false"]})})})}),angular.module("businessSetup.controllers",[]).controller("businessCtrl",["$scope","CRUDService",function(a,b){a.editItem=function(b){_.pull(a.itemList,b),a.itemCopy=angular.copy(b),a.item=b},a.createItem=function(){b.create("createBusiness",a)},a.saveItem=function(c){var d=b.validateForm(a);d&&b.update("saveBusiness",a,c)},a.cancelEdit=function(){b.cancelEdit(a)},a.$on("$stateChangeStart",function(b,c){_.contains(["businessSetup.locations","businessSetup.coachList","businessSetup.services"],c.name)&&(!a.itemList||a.itemList.length<=0)&&(b.preventDefault(),a.addAlert({type:"warning",message:"businessSetup:add-business-warning"}))}),b.get("getBusiness",a)}]).controller("locationsCtrl",["$scope","$http","CRUDService",function(a,b,c){a.createItem=function(){c.create("createLocation",a)},a.editItem=function(b){_.pull(a.itemList,b),a.itemCopy=angular.copy(b),a.item=b},a.saveItem=function(b){var e=c.validateForm(a);e=d(e),e&&c.update("saveLocation",a,b)},a.cancelEdit=function(){c.cancelEdit(a)};var d=function(b){var c=a.item.name,d=a.item.address;return _.find(a.itemList,{name:c,address:d})&&(a.addAlert({type:"warning",message:"businessSetup:location-already-exists"}),b=!1),b};a.$on("$stateChangeStart",function(b,c){_.contains(["businessSetup.coachList","businessSetup.services"],c.name)&&(!a.itemList||a.itemList.length<=0)&&(b.preventDefault(),a.addAlert({type:"warning",message:"businessSetup:add-location-warning"}))}),c.get("getLocations",a)}]).controller("coachesCtrl",["$scope","CRUDService",function(a,b){a.editItem=function(b){_.pull(a.itemList,b),a.itemCopy=angular.copy(b),a.item=b,a.weekdays=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]},a.createItem=function(){b.create("createCoach",a)},a.cancelEdit=function(){b.cancelEdit(a)},a.saveItem=function(d){var e=b.validateForm(a);e=c(e),e&&b.update("saveCoach",a,d)};var c=function(b){var c=a.item.firstName,d=a.item.lastName;return _.find(a.itemList,{firstName:c,lastName:d})&&(a.addAlert({type:"warning",message:"businessSetup:name-already-exists"}),b=!1),b};a.$on("$stateChangeStart",function(b,c){"businessSetup.services"===c.name&&(!a.itemList||a.itemList.length<=0)&&(b.preventDefault(),a.addAlert({type:"warning",message:"businessSetup:add-coach-warning"}))}),b.get("getCoaches",a)}]).controller("servicesCtrl",["$scope","CRUDService",function(a,b){a.createItem=function(){b.create("createService",a)},a.editItem=function(b){_.pull(a.itemList,b),a.itemCopy=angular.copy(b),a.item=b},a.saveItem=function(d){var e=b.validateForm(a);e=c(e),e&&b.update("saveService",a,d)},a.cancelEdit=function(){b.cancelEdit(a)};var c=function(b){var c=a.item.name;return _.find(a.itemList,{name:c})&&(a.addAlert({type:"warning",message:"businessSetup:service-already-exists"}),b=!1),b};a.$watch("item.repititon.repeatFrequency",function(b){(-1===b||null===b)&&(a.item.pricing.coursePrice=null)}),a.$on("$stateChangeStart",function(b,c){"businessSetup.scheduling"===c.name&&(!a.itemList||a.itemList.length<=0)&&(b.preventDefault(),a.addAlert({type:"warning",message:"businessSetup:add-services-warning"}))}),b.get("getServices",a)}]).controller("schedulingCtrl",["$scope",function(){console.log("SCHEDUling CTRL")}]),angular.module("businessSetup.directives",[]).directive("repeatSelector",function(){var a=[{value:"w",text:"week"},{value:"d",text:"day"},{value:null,text:"once"},{value:-1,text:"forever"}];return{scope:{sessionCount:"=",repeatFrequency:"="},templateUrl:"businessSetup/partials/repeatSelector.html",link:function(b){b.frequencies=a,b.$watch("repeatFrequency",function(a){-1===a||null===a?b.sessionCount=a:(b.sessionCount<0||null===b.sessionCount)&&a&&(b.sessionCount=2)}),b.showStatus=function(){var a=_.filter(b.frequencies,{value:b.repeatFrequency});return a[0]?a[0].text:"Not set"}}}}).directive("colorPicker",function(){var a=["red","green","blue","orange","yellow"];return{scope:{currentColor:"="},templateUrl:"businessSetup/partials/colorPicker.html",link:function(b){b.colors=a,b.$watch("currentColor",function(a){b.currentColor=a})}}}).directive("timeSlot",function(){return{replace:!0,templateUrl:"businessSetup/partials/timeSlot.html"}}).directive("timePicker",function(){return{replace:!0,templateUrl:"businessSetup/partials/timePicker.html",scope:{time:"="},link:function(a){a.$watch("time",function(b){if(a.time=b,a.time){var c=a.time.split(":");a.hours=parseFloat(c[0]),a.minutes=parseFloat(c[1])}}),a.increaseHours=function(){a.hours=a.hours<23?++a.hours:0,c()},a.decreaseHours=function(){a.hours=a.hours<=0?23:--a.hours,c()},a.increaseMinutes=function(){a.minutes>=45?(a.minutes=0,a.increaseHours()):a.minutes=a.minutes+15,c()},a.decreaseMinutes=function(){a.minutes<=0?(a.minutes=45,a.decreaseHours()):a.minutes=a.minutes-15,c()};var b=function(){return a.minutes<=9?"0"+a.minutes:a.minutes},c=function(){var c=b();a.time=a.hours+":"+c}}}}).directive("timeRangePicker",function(){return{replace:!1,scope:{start:"=",finish:"=",disabled:"=ngDisabled"},templateUrl:"businessSetup/partials/timeRangePicker.html",require:"ngModel",link:function(a,b,c,d){a.$watchGroup(["start","finish","disabled"],function(a){if(a[0]&&a[1]){var b=e(a[0]),c=e(a[1]);a[2]===!0||b.hours<c.hours?d.$setValidity("timeRange",!0):(b.hours===c.hours&&b.minutes>=c.minutes||b.hours>c.hours)&&d.$setValidity("timeRange",!1)}});var e=function(a){var b=a.split(":");return a={},a.hours=parseFloat(b[0]),a.minutes=parseFloat(b[1]),a}}}}),angular.module("businessSetup",["businessSetup.controllers","businessSetup.directives","businessSetup.services"]).config(["$stateProvider",function(a){a.state("businessSetup",{url:"/business-setup",templateUrl:"businessSetup/partials/businessSetup.html"}).state("businessSetup.business",{url:"/business",views:{"list-item-view":{templateUrl:"businessSetup/partials/businessView.html",controller:"businessCtrl"}}}).state("businessSetup.locations",{url:"/locations",views:{"list-item-view":{templateUrl:"businessSetup/partials/locationsView.html",controller:"locationsCtrl"}}}).state("businessSetup.coachList",{url:"/coach-list",views:{"list-item-view":{templateUrl:"businessSetup/partials/coachesView.html",controller:"coachesCtrl"}}}).state("businessSetup.services",{url:"/services",views:{"list-item-view":{templateUrl:"businessSetup/partials/servicesView.html",controller:"servicesCtrl"}}}).state("businessSetup.scheduling",{url:"/scheduling",views:{"list-item-view":{templateUrl:"businessSetup/partials/schedulingView.html",controller:"schedulingCtrl"}}})}]),angular.module("businessSetup.services",[]).service("CRUDService",["coachSeekAPIService","$activityIndicator",function(a,b){this.get=function(c,d){b.startAnimating(),a[c]().then(function(a){_.size(a)?d.itemList=a:(d.itemList=[],d.createItem())},function(a){d.addAlert({type:"danger",message:"businessSetup:"+a.message})})["finally"](function(){b.stopAnimating()})},this.create=function(c,d){b.startAnimating(),a[c]().then(function(a){d.newItem=!0,d.editItem(a)},function(a){d.addAlert({type:"danger",message:"businessSetup:"+a.message})})["finally"](function(){b.stopAnimating()})},this.update=function(e,f,g){b.startAnimating(),a[e]().then(function(){f.itemList.push(g),c(f),f.addAlert({type:"success",message:"businessSetup:save-success",name:g.name?g.name:d(g)})},function(a){f.addAlert({type:"danger",message:"businessSetup:"+a.message})})["finally"](function(){b.stopAnimating()})},this.cancelEdit=function(a){a.newItem||a.itemList.push(a.itemCopy),c(a)},this.validateForm=function(a){var b=a.itemForm.$valid;if(!b){var c=a.itemForm.$error;_.forEach(c,function(b,c){_.forEach(b,function(b){var d=b&&b.$name?b.$name:c;a.addAlert({type:"warning",message:"businessSetup:"+d+"-invalid"})})})}return b};var c=function(a){a.item=null,a.removeAlerts(),a.newItem=null,a.itemCopy=null},d=function(a){return a.firstName&&a.lastName?a.firstName+" "+a.lastName:a.business?a.business.name:void 0}}]),describe("CRUDService",function(){var a,b,c,d,e,f,g="getCoaches",h="ERROR BRO",i={};beforeEach(function(){a=$rootScope.$new(),b=$injector.get("CRUDService"),c=$injector.get("coachSeekAPIService"),d=$injector.get("$activityIndicator"),e=this.sinon.stub(d,"startAnimating"),f=this.sinon.stub(d,"stopAnimating")}),describe("when calling get()",function(){it("should start the activity indicator",function(){b.get(g,a),expect(e).to.be.calledOnce}),describe("when API call is successful",function(){var d;beforeEach(function(){this.sinon.stub(c,g,function(){var a=$q.defer();return a.resolve(d),a.promise})}),describe("and there is no existing data",function(){var c;beforeEach(function(){d=[],a.createItem=function(){},c=this.sinon.stub(a,"createItem"),b.get(g,a),$rootScope.$apply()}),it("should set the itemList on the scope",function(){expect(a.itemList.length).to.equal(d.length)}),it("should call attempt to creat a new item",function(){expect(c).to.be.calledOnce}),it("should stop the activity indicator",function(){expect(f).to.be.calledOnce})}),describe("and there is existing data",function(){beforeEach(function(){d=[{},{}],b.get(g,a),$rootScope.$apply()}),it("should set the itemList on the scope",function(){expect(a.itemList).to.equal(d)}),it("should stop the activity indicator",function(){expect(f).to.be.calledOnce})})}),describe("when API call throws an error",function(){beforeEach(function(){this.sinon.stub(c,g,function(){var a=$q.defer();return a.reject(new Error(h)),a.promise}),b.get(g,a),$rootScope.$apply()}),it("should display an error message",function(){expect($rootScope.alerts[0].type).to.equal("danger"),expect($rootScope.alerts[0].message).to.equal("businessSetup:"+h)}),it("should stop the activity indicator",function(){expect(f).to.be.calledOnce})})}),describe("when calling create()",function(){it("should start the activity indicator",function(){b.create(g,a),expect(e).to.be.calledOnce}),describe("when API call is successful",function(){beforeEach(function(){this.sinon.stub(c,g,function(){var a=$q.defer();return a.resolve([]),a.promise}),a.editItem=function(){},editItemStub=this.sinon.stub(a,"editItem"),b.create(g,a),$rootScope.$apply()}),it("should set the newItem to true",function(){expect(a.newItem).to.equal(!0)}),it("should call attempt to creat a new item",function(){expect(editItemStub).to.be.calledOnce}),it("should stop the activity indicator",function(){expect(f).to.be.calledOnce})}),describe("when API call throws an error",function(){beforeEach(function(){this.sinon.stub(c,g,function(){var a=$q.defer();return a.reject(new Error(h)),a.promise}),b.create(g,a),$rootScope.$apply()}),it("should display an error message",function(){expect($rootScope.alerts[0].type).to.equal("danger"),expect($rootScope.alerts[0].message).to.equal("businessSetup:"+h)}),it("should stop the activity indicator",function(){expect(f).to.be.calledOnce})})}),describe("when calling update()",function(){it("should start the activity indicator",function(){b.update(g,a,{}),expect(e).to.be.calledOnce}),describe("when API call is successful",function(){var d;beforeEach(function(){a.itemList=[],a.removeAlerts=function(){},this.sinon.stub(c,g,function(){var a=$q.defer();return a.resolve("data"),a.promise}),d=this.sinon.stub(a,"removeAlerts"),b.update(g,a,i),$rootScope.$apply()}),it("should add the item back to the itemList",function(){expect(a.itemList[0]).to.equal(i)}),it("should set reset the to the list view state",function(){expect(a.item).to.equal(null),expect(a.newItem).to.equal(null),expect(a.itemCopy).to.equal(null),expect(d).to.be.calledOnce}),it("should add a success alert",function(){expect($rootScope.alerts[0].type).to.equal("success"),expect($rootScope.alerts[0].message).to.equal("businessSetup:save-success")}),it("should stop the activity indicator",function(){expect(f).to.be.calledOnce})}),describe("when API call throws an error",function(){beforeEach(function(){this.sinon.stub(c,g,function(){var a=$q.defer();return a.reject(new Error(h)),a.promise}),b.update(g,a,{}),$rootScope.$apply()}),it("should display an error message",function(){expect($rootScope.alerts[0].type).to.equal("danger"),expect($rootScope.alerts[0].message).to.equal("businessSetup:"+h)}),it("should stop the activity indicator",function(){expect(f).to.be.calledOnce})})}),describe("when calling cancelEdit()",function(){var c;beforeEach(function(){a.itemList=[],a.itemCopy=i,a.removeAlerts=function(){},c=this.sinon.stub(a,"removeAlerts")}),it("should set reset the to the list view state",function(){a.newItem="A COOL THING",a.item=["a","useless","array"],b.cancelEdit(a),expect(a.item).to.equal(null),expect(a.newItem).to.equal(null),expect(a.itemCopy).to.equal(null),expect(c).to.be.calledOnce}),describe("when the item is new",function(){it("should NOT add the item to the itemList",function(){a.newItem=!0,b.cancelEdit(a),expect(a.itemList[0]).to.be.undefined})}),describe("when the item is NOT new",function(){it("should add the item to the itemList",function(){a.newItem=!1,b.cancelEdit(a),expect(a.itemList[0]).to.equal(i)})})}),describe("when calling validateForm()",function(){})}),describe("BusinessSetup Module",function(){var a,b;beforeEach(function(){b=$injector.get("coachSeekAPIService"),a=$rootScope.$new()}),describe("businessSetup states",function(){describe("when navigating to businessSetup.business",function(){var a;beforeEach(function(){$state.go("businessSetup.business"),$rootScope.$digest(),a=$state.current.views["list-item-view"]}),it("should map to correct template",function(){expect(a.templateUrl).to.equal("businessSetup/partials/businessView.html")}),it("should map to the correct controller",function(){expect(a.controller).to.equal("businessCtrl")})}),describe("when navigating to businessSetup.services",function(){var a;beforeEach(function(){$state.go("businessSetup.services"),$rootScope.$digest(),a=$state.current.views["list-item-view"]}),it("should map to correct template",function(){expect(a.templateUrl).to.equal("businessSetup/partials/servicesView.html")}),it("should map to the correct controller",function(){expect(a.controller).to.equal("servicesCtrl")})}),describe("when navigating to businessSetup.coachList",function(){var a;beforeEach(function(){$state.go("businessSetup.coachList"),$rootScope.$digest(),a=$state.current.views["list-item-view"]}),it("should map to correct template",function(){expect(a.templateUrl).to.equal("businessSetup/partials/coachesView.html")}),it("should map to the correct controller",function(){expect(a.controller).to.equal("coachesCtrl")})}),describe("when navigating to businessSetup.locations",function(){var a;beforeEach(function(){$state.go("businessSetup.locations"),$rootScope.$digest(),a=$state.current.views["list-item-view"]}),it("should map to correct template",function(){expect(a.templateUrl).to.equal("businessSetup/partials/locationsView.html")}),it("should map to the correct controller",function(){expect(a.controller).to.equal("locationsCtrl")})}),describe("when navigating to businessSetup.scheduling",function(){var a;beforeEach(function(){$state.go("businessSetup.scheduling"),$rootScope.$digest(),a=$state.current.views["list-item-view"]}),it("should map to correct template",function(){expect(a.templateUrl).to.equal("businessSetup/partials/schedulingView.html")}),it("should map to the correct controller",function(){expect(a.controller).to.equal("schedulingCtrl")})})})}),describe("BusinessSetup Business",function(){var a,b;beforeEach(function(){b=$injector.get("coachSeekAPIService"),a=$rootScope.$new()}),describe("when the page loads",function(){var c,d,e,f,g,h="businessSetup/partials/businessView.html";beforeEach(function(){g=this,g.let("business",function(){return{}}),e=this.sinon.stub(b,"getBusiness",function(){var a=$q.defer();return a.resolve(g.business),a.promise}),f=this.sinon.stub(b,"createBusiness",function(){var a=$q.defer();return a.resolve([{}]),a.promise})}),it("should attempt to call getBusiness",function(){createViewWithController(a,h,"businessCtrl"),expect(e).to.be.calledOnce}),describe("when getBusiness throws an error",function(){var c="errorMessage";beforeEach(function(){e.restore(),e=this.sinon.stub(b,"getBusiness",function(){var a=$q.defer();return a.reject(new Error(c)),a.promise})}),it("should throw",function(){expect(createViewWithController(a,h,"businessCtrl")).to["throw"]}),it("should display an error message",function(){createViewWithController(a,h,"businessCtrl"),expect($rootScope.alerts[0].type).to.equal("danger"),expect($rootScope.alerts[0].message).to.equal("businessSetup:"+c)})}),describe("and there is no existing business",function(){beforeEach(function(){createViewWithController(a,h,"businessCtrl"),d=$testRegion.find(".business-item-view")}),it("should not show the business list view",function(){expect($testRegion.find(".business-list-view").hasClass("ng-hide")).to.be["true"]}),it("should show the business edit view",function(){expect($testRegion.find(".business-item-view").hasClass("ng-hide")).to.be["false"]}),it("should attempt to create a business",function(){expect(f).to.be.calledOnce}),it("should not show the cancel button",function(){expect(d.find(".cancel-button").hasClass("ng-hide")).to.be["true"]})}),describe("and there is a business",function(){beforeEach(function(){g.let("firstBusiness",function(){return{business:{name:"West Coast Toast"},admin:{firstName:"Toast",lastName:"Master",email:"toastmaster@westcoasttoast.com",password:"password"}}}),g.let("business",function(){return[g.firstBusiness]}),createViewWithController(a,h,"businessCtrl"),c=$testRegion.find(".business-list-view"),d=$testRegion.find(".business-item-view")}),it("should show the business list view",function(){expect(c.hasClass("ng-hide")).to.be["false"]}),it("should not show the business edit view",function(){expect(d.hasClass("ng-hide")).to.be["true"]}),describe("when clicking the edit button",function(){beforeEach(function(){c.find(".edit-business").first().trigger("click")}),it("should not show the business list view",function(){expect(c.hasClass("ng-hide")).to.be["true"]}),it("should show the business edit view",function(){expect(d.hasClass("ng-hide")).to.be["false"]}),it("should show the cancel button",function(){expect(d.find(".cancel-button").hasClass("ng-hide")).to.be["false"]}),describe("when clicking the save button",function(){var e;beforeEach(function(){e=this.sinon.stub(b,"saveBusiness",function(){var a=$q.defer();return a.resolve([{}]),a.promise})}),describe("when the form is invalid",function(){describe("when the name is invalid",function(){it("should display an invalid input alert",function(){a.item.business.name=null,a.$apply(),d.find(".save-business").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:name-invalid")})}),describe("when the firstName is invalid",function(){it("should display an invalid input alert",function(){a.item.admin.firstName=null,a.$apply(),d.find(".save-business").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:firstName-invalid")})}),describe("when the lastName is invalid",function(){it("should display an invalid input alert",function(){a.item.admin.lastName=null,a.$apply(),d.find(".save-business").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:lastName-invalid")})}),describe("when the email is invalid",function(){it("should display an invalid input alert",function(){a.item.admin.email="badEmail.com",a.$apply(),d.find(".save-business").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:email-invalid")})}),describe("when the password is invalid",function(){it("should display an invalid input alert",function(){a.item.admin.password="short",a.$apply(),d.find(".save-business").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:password-invalid")})})}),describe("when all inputs are valid",function(){beforeEach(function(){d.find(".save-business").trigger("click")}),it("should attempt to save business",function(){expect(e).to.be.calledOnce}),it("should show the business list view",function(){expect(c.hasClass("ng-hide")).to.be["false"]}),it("should not show the business edit view",function(){expect(d.hasClass("ng-hide")).to.be["true"]})})}),describe("when clicking the cancel button",function(){beforeEach(function(){a.item={business:{name:"New Dumb"},admin:{firstName:"Business",lastName:"Thing",email:"newdumb@westcoasttoast.com",password:"passwords"}},a.$apply(),$rootScope.alerts.push({type:"warning",message:"test alert"}),d.find(".cancel-button").trigger("click")}),it("should reset all edits made",function(){var b=a.itemList.pop();expect(b.firstName).to.equal(g.firstBusiness.firstName),expect(b.lastName).to.equal(g.firstBusiness.lastName),expect(b.email).to.equal(g.firstBusiness.email),expect(b.phone).to.equal(g.firstBusiness.phone)}),it("should remove alert if present",function(){expect($rootScope.alerts.length).to.equal(0)})})})}),describe("when navigating before adding a business",function(){describe("when navigating to locations",function(){beforeEach(function(){createViewWithController(a,"businessSetup/partials/businessSetup.html","businessCtrl"),$state.go("businessSetup.business"),a.$digest(),$state.go("businessSetup.locations"),a.$digest()}),it("should not allow navigation",function(){expect($location.path()).to.equal("/business-setup/business")}),it("should show a warning message",function(){expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:add-business-warning")}),describe("after adding a business",function(){beforeEach(function(){a.itemList=[{}],$state.go("businessSetup.locations"),a.$digest()}),it("should allow navigation",function(){expect($location.path()).to.equal("/business-setup/locations")})})}),describe("when navigating to coachList",function(){beforeEach(function(){createViewWithController(a,"businessSetup/partials/businessSetup.html","businessCtrl"),$state.go("businessSetup.business"),a.$digest(),$state.go("businessSetup.coachList"),a.$digest()}),it("should not allow navigation",function(){expect($location.path()).to.equal("/business-setup/business")}),it("should show a warning message",function(){expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:add-business-warning")}),describe("after adding a business",function(){beforeEach(function(){a.itemList=[{}],$state.go("businessSetup.coachList"),a.$digest()}),it("should allow navigation",function(){expect($location.path()).to.equal("/business-setup/coach-list")})})}),describe("when navigating to services",function(){beforeEach(function(){createViewWithController(a,"businessSetup/partials/businessSetup.html","businessCtrl"),$state.go("businessSetup.business"),a.$digest(),$state.go("businessSetup.services"),a.$digest()}),it("should not allow navigation",function(){expect($location.path()).to.equal("/business-setup/business")}),it("should show a warning message",function(){expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:add-business-warning")}),describe("after adding a business",function(){beforeEach(function(){a.itemList=[{}],$state.go("businessSetup.services"),a.$digest()}),it("should allow navigation",function(){expect($location.path()).to.equal("/business-setup/services")})})})})})}),describe("BusinessSetup Coach List",function(){var a,b;beforeEach(function(){b=$injector.get("coachSeekAPIService"),a=$rootScope.$new()}),describe("when the page loads",function(){var c,d,e,f,g,h="businessSetup/partials/coachesView.html";beforeEach(function(){g=this,g.let("coaches",function(){return[]}),e=this.sinon.stub(b,"getCoaches",function(){var a=$q.defer();return a.resolve(g.coaches),a.promise}),f=this.sinon.stub(b,"createCoach",function(){var a=$q.defer();return a.resolve([{}]),a.promise})}),it("should attempt to call getCoaches",function(){createViewWithController(a,h,"coachesCtrl"),expect(e).to.be.calledOnce}),describe("when getCoaches throws an error",function(){var c="errorMessage";beforeEach(function(){e.restore(),e=this.sinon.stub(b,"getCoaches",function(){var a=$q.defer();return a.reject(new Error(c)),a.promise})}),it("should throw",function(){expect(createViewWithController(a,h,"coachesCtrl")).to["throw"]}),it("should display an error message",function(){createViewWithController(a,h,"coachesCtrl"),expect($rootScope.alerts[0].type).to.equal("danger"),expect($rootScope.alerts[0].message).to.equal("businessSetup:"+c)})}),describe("and there are no coaches",function(){beforeEach(function(){createViewWithController(a,h,"coachesCtrl"),d=$testRegion.find(".coach-item-view")}),it("should not show the coach list view",function(){expect($testRegion.find(".coach-list-view").hasClass("ng-hide")).to.be["true"]}),it("should show the coach edit view",function(){expect($testRegion.find(".coach-item-view").hasClass("ng-hide")).to.be["false"]}),it("should attempt to create a coach",function(){expect(f).to.be.calledOnce}),it("should not show the cancel button",function(){expect(d.find(".cancel-button").hasClass("ng-hide")).to.be["true"]})}),describe("and there are one or more coaches",function(){beforeEach(function(){g.let("firstCoach",function(){return{firstName:"Test",lastName:"User",email:"test@example.com",phone:"9090909"}}),g.let("coaches",function(){return[g.firstCoach,{}]}),createViewWithController(a,h,"coachesCtrl"),c=$testRegion.find(".coach-list-view"),d=$testRegion.find(".coach-item-view")}),it("should show the coach list view",function(){expect(c.hasClass("ng-hide")).to.be["false"]}),it("should have as many list entries as coaches",function(){expect(c.find(".coach-details").length).to.equal(g.coaches.length)}),it("should not show the coach edit view",function(){expect(d.hasClass("ng-hide")).to.be["true"]}),describe("when clicking the edit button",function(){beforeEach(function(){c.find(".edit-coach").first().trigger("click")}),it("should not show the coach list view",function(){expect(c.hasClass("ng-hide")).to.be["true"]}),it("should show the coach edit view",function(){expect(d.hasClass("ng-hide")).to.be["false"]}),it("should show the cancel button",function(){expect(d.find(".cancel-button").hasClass("ng-hide")).to.be["false"]}),describe("when clicking the save button",function(){var e;beforeEach(function(){e=this.sinon.stub(b,"saveCoach",function(){var a=$q.defer();
return a.resolve([{}]),a.promise})}),describe("when the form is invalid",function(){describe("when the firstName is invalid",function(){it("should display an invalid input alert",function(){a.item.firstName=null,a.$apply(),d.find(".save-coach").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:firstName-invalid")})}),describe("when the lastName is invalid",function(){it("should display an invalid input alert",function(){a.item.lastName=null,a.$apply(),d.find(".save-coach").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:lastName-invalid")})}),describe("when the phone is invalid",function(){it("should display an invalid input alert",function(){a.item.phone=null,a.$apply(),d.find(".save-coach").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:phone-invalid")})}),describe("when the email is invalid",function(){it("should display an invalid input alert",function(){a.item.email="badEmail.com",a.$apply(),d.find(".save-coach").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:email-invalid")})}),describe("when a timeRange is invalid",function(){it("should display an invalid input alert",function(){a.itemForm.$setValidity("timeRange",!1),d.find(".save-coach").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:timeRange-invalid")})})}),describe("when the coach name already exists",function(){beforeEach(function(){a.itemList.push(angular.copy(g.firstCoach)),d.find(".save-coach").trigger("click")}),it("should display an alert",function(){expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:name-already-exists")})}),describe("when the coach name is new",function(){beforeEach(function(){d.find(".save-coach").trigger("click")}),it("should attempt to save coach",function(){expect(e).to.be.calledOnce}),it("should show the coach list view",function(){expect(c.hasClass("ng-hide")).to.be["false"]}),it("should not show the coach edit view",function(){expect(d.hasClass("ng-hide")).to.be["true"]})})}),describe("when clicking the cancel button",function(){beforeEach(function(){a.item={firstName:"dumbnew",lastName:"userguy",email:"dude@dude.com",phone:"021 99 88 77"},a.$apply(),$rootScope.alerts.push({type:"warning",message:"test alert"}),d.find(".cancel-button").trigger("click")}),it("should reset all edits made",function(){var b=a.itemList.pop();expect(b.firstName).to.equal(g.firstCoach.firstName),expect(b.lastName).to.equal(g.firstCoach.lastName),expect(b.email).to.equal(g.firstCoach.email),expect(b.phone).to.equal(g.firstCoach.phone)}),it("should remove alert if present",function(){expect($rootScope.alerts.length).to.equal(0)})})}),describe("when creating a new coach",function(){var b;beforeEach(function(){b=a.itemList.length,c.find(".create-coach").trigger("click")}),it("should attempt to create a coach",function(){expect(f).to.be.calledOnce}),it("should not show the coach list view",function(){expect($testRegion.find(".coach-list-view").hasClass("ng-hide")).to.be["true"]}),it("should show the coach edit view",function(){expect($testRegion.find(".coach-item-view").hasClass("ng-hide")).to.be["false"]}),it("should show the cancel button",function(){expect(d.find(".cancel-button").hasClass("ng-hide")).to.be["false"]}),it("should set the newItem flag to true",function(){expect(a.newItem).to.be["true"]}),describe("when clicking the cancel button and coach is new",function(){beforeEach(function(){d.find(".cancel-button").trigger("click")}),it("should discard the new coach",function(){expect(a.itemList.length).to.equal(b)})})})}),describe("when navigating to services before adding a coach",function(){beforeEach(function(){createViewWithController(a,"businessSetup/partials/businessSetup.html","coachesCtrl"),$state.go("businessSetup.coachList"),a.$digest(),$state.go("businessSetup.services"),a.$digest()}),it("should not allow navigation",function(){expect($location.path()).to.equal("/business-setup/coach-list")}),it("should show a warning message",function(){expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:add-coach-warning")}),describe("after adding a coach",function(){beforeEach(function(){a.itemList=[{}],$state.go("businessSetup.services"),a.$digest()}),it("should allow navigation",function(){expect($location.path()).to.equal("/business-setup/services")})})})})}),describe("bussinessSetup Locations",function(){var a,b,c,d,e,f="businessSetup/partials/locationsView.html";beforeEach(function(){e=$injector.get("coachSeekAPIService"),d=$rootScope.$new(),c=this,c.let("locations",function(){return[]}),getLocationsStub=this.sinon.stub(e,"getLocations",function(){var a=$q.defer();return a.resolve(c.locations),a.promise}),createLocationStub=this.sinon.stub(e,"createLocation",function(){var a=$q.defer();return a.resolve([{}]),a.promise})}),it("should make a call to getLocations",function(){createViewWithController(d,f,"locationsCtrl"),expect(getLocationsStub).to.be.calledOnce}),describe("and there are no locations",function(){beforeEach(function(){createViewWithController(d,f,"locationsCtrl"),a=$testRegion.find(".location-item-view")}),it("should not show the location list view",function(){expect($testRegion.find(".location-list-view").hasClass("ng-hide")).to.be["true"]}),it("should show the location item view",function(){expect($testRegion.find(".location-item-view").hasClass("ng-hide")).to.be["false"]}),it("should attempt to create a location",function(){expect(createLocationStub).to.be.calledOnce}),it("should not show the cancel button",function(){expect(a.find(".cancel-location").hasClass("ng-hide")).to.be["true"]})}),describe("and there are one or more locations",function(){beforeEach(function(){c.let("firstLocation",function(){return{businessId:"8786bcd0-3b14-4f7b-92db-198527a5b949",id:null,name:"THE LAB",address:"1800 taylor ave n",city:"Seattle",state:"WA",country:"USA"}}),c.let("locations",function(){return[c.firstLocation,{}]}),createViewWithController(d,f,"locationsCtrl"),b=$testRegion.find(".location-list-view"),a=$testRegion.find(".location-item-view")}),it("should show the location list view",function(){expect(b.hasClass("ng-hide")).to.be["false"]}),it("should have as many list entries as location",function(){expect(b.find(".location-details").length).to.equal(c.locations.length)}),it("should not show the location item view",function(){expect(a.hasClass("ng-hide")).to.be["true"]}),describe("when clicking the edit button",function(){beforeEach(function(){b.find(".edit-location").first().trigger("click")}),it("should not show the location list view",function(){expect(b.hasClass("ng-hide")).to.be["true"]}),it("should show the location item view",function(){expect(a.hasClass("ng-hide")).to.be["false"]}),it("should show the cancel button",function(){expect(a.find(".cancel-location").hasClass("ng-hide")).to.be["false"]}),describe("when clicking the save button",function(){var f;beforeEach(function(){f=this.sinon.stub(e,"saveLocation",function(){var a=$q.defer();return a.resolve([{}]),a.promise})}),describe("when the form is invalid",function(){describe("when the name is invalid",function(){it("should display an invalid input alert",function(){d.item.name=null,d.$apply(),a.find(".save-location").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:name-invalid")})}),describe("when the studentCapacity is invalid",function(){})}),describe("when the name already exists",function(){beforeEach(function(){d.itemList.push(angular.copy(c.firstLocation)),a.find(".save-location").trigger("click")}),it("should display an alert",function(){expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:location-already-exists")})}),describe("when the name is new",function(){beforeEach(function(){a.find(".save-location").trigger("click")}),it("should attempt to save location",function(){expect(f).to.be.calledOnce}),it("should show the location list view",function(){expect(b.hasClass("ng-hide")).to.be["false"]}),it("should not show the location edit view",function(){expect(a.hasClass("ng-hide")).to.be["true"]})})}),describe("when clicking the cancel button",function(){beforeEach(function(){d.item={name:"dumbnew",description:"userguy"},d.$apply(),$rootScope.alerts.push({type:"warning",message:"test alert"}),a.find(".cancel-location").trigger("click")}),it("should reset all edits made",function(){var a=d.itemList.pop();expect(a.name).to.equal(c.firstLocation.name),expect(a.description).to.equal(c.firstLocation.description)}),it("should remove alert if present",function(){expect($rootScope.alerts.length).to.equal(0)})})}),describe("when creating a new location",function(){var c;beforeEach(function(){c=d.itemList.length,b.find(".create-location").trigger("click")}),it("should attempt to create a location",function(){expect(createLocationStub).to.be.calledOnce}),it("should not show the location list view",function(){expect($testRegion.find(".location-list-view").hasClass("ng-hide")).to.be["true"]}),it("should show the location item view",function(){expect($testRegion.find(".location-item-view").hasClass("ng-hide")).to.be["false"]}),it("should show the cancel button",function(){expect(a.find(".cancel-button").hasClass("ng-hide")).to.be["false"]}),it("should set the newItem flag to true",function(){expect(d.newItem).to.be["true"]}),describe("when clicking the cancel button and location is new",function(){beforeEach(function(){a.find(".cancel-location").trigger("click")}),it("should discard the new location",function(){expect(d.itemList.length).to.equal(c)})})})}),describe("when navigating before adding a location",function(){describe("when navigating to coachList",function(){beforeEach(function(){createViewWithController(d,"businessSetup/partials/businessSetup.html","locationsCtrl"),$state.go("businessSetup.locations"),d.$digest(),$state.go("businessSetup.coachList"),d.$digest()}),it("should not allow navigation",function(){expect($location.path()).to.equal("/business-setup/locations")}),it("should show a warning message",function(){expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:add-location-warning")}),describe("after adding a location",function(){beforeEach(function(){d.itemList=[{}],$state.go("businessSetup.coachList"),d.$digest()}),it("should allow navigation",function(){expect($location.path()).to.equal("/business-setup/coach-list")})})}),describe("when navigating to services",function(){beforeEach(function(){createViewWithController(d,"businessSetup/partials/businessSetup.html","locationsCtrl"),$state.go("businessSetup.locations"),d.$digest(),$state.go("businessSetup.services"),d.$digest()}),it("should not allow navigation",function(){expect($location.path()).to.equal("/business-setup/locations")}),it("should show a warning message",function(){expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:add-location-warning")}),describe("after adding a location",function(){beforeEach(function(){d.itemList=[{}],$state.go("businessSetup.services"),d.$digest()}),it("should allow navigation",function(){expect($location.path()).to.equal("/business-setup/services")})})})})}),describe("bussinessSetup Services",function(){var a,b,c,d,e,f="businessSetup/partials/servicesView.html";beforeEach(function(){e=$injector.get("coachSeekAPIService"),d=$rootScope.$new(),c=this,c.let("services",function(){return[]}),getServicesStub=this.sinon.stub(e,"getServices",function(){var a=$q.defer();return a.resolve(c.services),a.promise}),createServiceStub=this.sinon.stub(e,"createService",function(){var a=$q.defer();return a.resolve([{}]),a.promise})}),it("should make a call to getServices",function(){createViewWithController(d,f,"servicesCtrl"),expect(getServicesStub).to.be.calledOnce}),describe("and there are no services",function(){beforeEach(function(){createViewWithController(d,f,"servicesCtrl"),a=$testRegion.find(".service-item-view")}),it("should not show the service list view",function(){expect($testRegion.find(".service-list-view").hasClass("ng-hide")).to.be["true"]}),it("should show the service item view",function(){expect($testRegion.find(".service-item-view").hasClass("ng-hide")).to.be["false"]}),it("should attempt to create a service",function(){expect(createServiceStub).to.be.calledOnce}),it("should not show the cancel button",function(){expect(a.find(".cancel-service").hasClass("ng-hide")).to.be["true"]})}),describe("and there are one or more services",function(){beforeEach(function(){c.let("firstService",function(){return{name:"Test",description:"User",booking:{studentCapacity:8},pricing:{sessionPrice:43,coursePrice:69},repititon:{repeatFrequency:2}}}),c.let("services",function(){return[c.firstService,{}]}),createViewWithController(d,f,"servicesCtrl"),b=$testRegion.find(".service-list-view"),a=$testRegion.find(".service-item-view")}),it("should show the service list view",function(){expect(b.hasClass("ng-hide")).to.be["false"]}),it("should have as many list entries as service",function(){expect(b.find(".service-details").length).to.equal(c.services.length)}),it("should not show the service item view",function(){expect(a.hasClass("ng-hide")).to.be["true"]}),describe("when clicking the edit button",function(){beforeEach(function(){b.find(".edit-service").first().trigger("click")}),it("should not show the service list view",function(){expect(b.hasClass("ng-hide")).to.be["true"]}),it("should show the service item view",function(){expect(a.hasClass("ng-hide")).to.be["false"]}),it("should show the cancel button",function(){expect(a.find(".cancel-service").hasClass("ng-hide")).to.be["false"]}),describe("when changing the repeatFrequency to -1 or null",function(){it("should set the coursePrice to null",function(){d.item.repititon.repeatFrequency=null,d.$apply(),expect(d.item.pricing.coursePrice).to.equal(null)})}),describe("when clicking the save button",function(){var f;beforeEach(function(){f=this.sinon.stub(e,"saveService",function(){var a=$q.defer();return a.resolve([{}]),a.promise})}),describe("when the form is invalid",function(){describe("when the name is invalid",function(){it("should display an invalid input alert",function(){d.item.name=null,d.$apply(),a.find(".save-service").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:name-invalid")})}),describe("when the studentCapacity is invalid",function(){it("should display an invalid input alert",function(){d.item.booking.studentCapacity=-1,d.$apply(),a.find(".save-service").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:studentCapacity-invalid")})}),describe("when the sessionPrice is invalid",function(){it("should display an invalid input alert",function(){d.item.pricing.sessionPrice=-1,d.$apply(),a.find(".save-service").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:sessionPrice-invalid")})}),describe("when the coursePrice is invalid",function(){it("should display an invalid input alert",function(){d.item.pricing.coursePrice=-1,d.$apply(),a.find(".save-service").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:coursePrice-invalid")})}),describe("and the sessionPrice and coursePrice are invalid",function(){it("should display an alert for both",function(){d.item.pricing.sessionPrice=-1,d.item.pricing.coursePrice=-1,d.$apply(),a.find(".save-service").trigger("click"),expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:sessionPrice-invalid"),expect($rootScope.alerts[1].type).to.equal("warning"),expect($rootScope.alerts[1].message).to.equal("businessSetup:coursePrice-invalid")})})}),describe("when the name already exists",function(){beforeEach(function(){d.itemList.push(angular.copy(c.firstService)),a.find(".save-service").trigger("click")}),it("should display an alert",function(){expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:service-already-exists")})}),describe("when the name is new",function(){beforeEach(function(){a.find(".save-service").trigger("click")}),it("should attempt to save service",function(){expect(f).to.be.calledOnce}),it("should show the services list view",function(){expect(b.hasClass("ng-hide")).to.be["false"]}),it("should not show the service edit view",function(){expect(a.hasClass("ng-hide")).to.be["true"]})})}),describe("when clicking the cancel button",function(){beforeEach(function(){d.item={name:"dumbnew",description:"userguy"},d.$apply(),$rootScope.alerts.push({type:"warning",message:"test alert"}),a.find(".cancel-service").trigger("click")}),it("should reset all edits made",function(){var a=d.itemList.pop();expect(a.name).to.equal(c.firstService.name),expect(a.description).to.equal(c.firstService.description)}),it("should remove alert if present",function(){expect($rootScope.alerts.length).to.equal(0)})})}),describe("when creating a new service",function(){var c;beforeEach(function(){c=d.itemList.length,b.find(".create-service").trigger("click")}),it("should attempt to create a service",function(){expect(createServiceStub).to.be.calledOnce}),it("should not show the service list view",function(){expect($testRegion.find(".service-list-view").hasClass("ng-hide")).to.be["true"]}),it("should show the service item view",function(){expect($testRegion.find(".service-item-view").hasClass("ng-hide")).to.be["false"]}),it("should show the cancel button",function(){expect(a.find(".cancel-button").hasClass("ng-hide")).to.be["false"]}),it("should set the newItem flag to true",function(){expect(d.newItem).to.be["true"]}),describe("when clicking the cancel button and service is new",function(){beforeEach(function(){a.find(".cancel-service").trigger("click")}),it("should discard the new service",function(){expect(d.itemList.length).to.equal(c)})})})}),describe("when navigating to scheduling before adding a service",function(){beforeEach(function(){createViewWithController(d,"businessSetup/partials/businessSetup.html","servicesCtrl"),$state.go("businessSetup.services"),d.$digest(),$state.go("businessSetup.scheduling"),d.$digest()}),it("should not allow navigation",function(){expect($location.path()).to.equal("/business-setup/services")}),it("should show a warning message",function(){expect($rootScope.alerts[0].type).to.equal("warning"),expect($rootScope.alerts[0].message).to.equal("businessSetup:add-services-warning")}),describe("after adding a service",function(){beforeEach(function(){d.itemList=[{}],$state.go("businessSetup.scheduling"),d.$digest()}),it("should allow navigation",function(){expect($location.path()).to.equal("/business-setup/scheduling")})})})}),describe("colorPicker directive",function(){var a;beforeEach(function(){a=$rootScope.$new(),this.let("currentColor",function(){return"blue"}),a.currentColor=this.currentColor,createDirective(a,'<div><color-picker current-color="currentColor"></color-picker></div>')}),it("should set the selected color to the current color on scope",function(){$currentColor=angular.element($testRegion.find(".selected")),expect($currentColor.scope().color).to.equal(this.currentColor)}),describe("when clicking on another color",function(){var b;beforeEach(function(){b=angular.element($testRegion.find("li:nth-child(2)")),b.triggerHandler("click")}),it("should set the currentColor to the new color",function(){expect(a.currentColor).to.equal(b.scope().color)})})}),describe("repeatSelector directive",function(){var a;beforeEach(function(){a=$rootScope.$new(),this.let("sessionCount",function(){return 12}),this.let("repeatFrequency",function(){return"w"}),a.sessionCount=this.sessionCount,a.repeatFrequency=this.repeatFrequency,createDirective(a,'<div><repeat-selector repeat-frequency="repeatFrequency" session-count="sessionCount"></repeat-selector></div>')}),it("should set the session count in the template",function(){var a=$testRegion.find(".session-count");expect(parseFloat(a.text())).to.equal(this.sessionCount)}),it("should set the repeat frequency count in the template",function(){var a=$testRegion.find(".repeat-frequency");a.get(0).click(),$repeatFrequencySelected=$testRegion.find("form [selected]"),expect($repeatFrequencySelected.text()).to.equal("week")}),describe("when changing the sessionCount",function(){beforeEach(function(){$sessionCount=$testRegion.find(".session-count"),$sessionCount.get(0).click(),$testRegion.find("input").val(130),angular.element($testRegion.find("input")).triggerHandler("change")}),describe("and then submittting the change",function(){it("should set the sessionCount to the scope",function(){var b=angular.element($testRegion.find("form"));b.triggerHandler("submit"),expect(a.sessionCount).to.equal(130)})}),describe("and then cancelling the change",function(){it("should set the sessionCount to the scope",function(){$("button[type='button']").trigger("click"),expect(a.sessionCount).to.equal(this.sessionCount)})})}),describe("when changing the repeat frequency",function(){var b;beforeEach(function(){b=$testRegion.find(".repeat-frequency"),b.get(0).click()}),describe("when changing it to days",function(){beforeEach(function(){$testRegion.find("select").val("1"),angular.element($testRegion.find("select")).triggerHandler("change")}),it("should set not reset the sessionCount",function(){expect(a.sessionCount).to.equal(this.sessionCount)}),it('should set the repeatFrequency to "d"',function(){expect(a.repeatFrequency).to.equal("d")}),describe("and then changing it back to weeks",function(){beforeEach(function(){b.get(0).click(),$testRegion.find("select").val("0"),angular.element($testRegion.find("select")).triggerHandler("change")}),it("should set not reset the sessionCount",function(){expect(a.sessionCount).to.equal(this.sessionCount)}),it('should set the repeatFrequency to "w"',function(){expect(a.repeatFrequency).to.equal("w")})})}),describe("when changing it to once",function(){beforeEach(function(){$testRegion.find("select").val("2"),angular.element($testRegion.find("select")).triggerHandler("change")}),it("should set the session count to null",function(){expect(a.sessionCount).to.equal(null)}),it("should set the repeatFrequency to null",function(){expect(a.repeatFrequency).to.equal(null)}),describe("and then changing it back to days",function(){beforeEach(function(){b.get(0).click(),$testRegion.find("select").val("1"),angular.element($testRegion.find("select")).triggerHandler("change")}),it("should reset the sessionCount to 2",function(){expect(a.sessionCount).to.equal(2)}),it('should set the repeatFrequency to "d"',function(){expect(a.repeatFrequency).to.equal("d")})})}),describe("when changing it to forever",function(){beforeEach(function(){$testRegion.find("select").val("3"),angular.element($testRegion.find("select")).triggerHandler("change")}),it("should set the session count to 1",function(){expect(a.sessionCount).to.equal(-1)}),it("should set the repeatFrequency to -1",function(){expect(a.repeatFrequency).to.equal(-1)}),describe("and then changing it back to weeks",function(){beforeEach(function(){b.get(0).click(),$testRegion.find("select").val("0"),angular.element($testRegion.find("select")).triggerHandler("change")}),it("should reset the sessionCount to 2",function(){expect(a.sessionCount).to.equal(2)}),it('should set the repeatFrequency to "w"',function(){expect(a.repeatFrequency).to.equal("w")})})})})}),describe("timePicker directive",function(){describe("when default time is provided",function(){var a;beforeEach(function(){a=$rootScope.$new(),this.let("testTime",function(){return"22:00"}),a.testTime=this.testTime,createDirective(a,'<div><time-picker time="testTime"></time-picker></div>')}),it("should set time to time provided",function(){expect(a.testTime).to.equal(this.testTime)}),describe("when clicking the increase hour button",function(){var b;beforeEach(function(){b=$testRegion.find(".increase .hours"),b.trigger("click")}),it("should add an hour to the set time",function(){expect(a.testTime).to.equal("23:00")})}),describe("when clicking the decrease hour button",function(){var b;beforeEach(function(){b=$testRegion.find(".decrease .hours"),b.trigger("click")}),it("should add an hour to the set time",function(){expect(a.testTime).to.equal("21:00")})}),describe("when clicking the increase minute button",function(){var b;beforeEach(function(){b=$testRegion.find(".increase .minutes")}),it("should increase the time by 15 minutes",function(){b.trigger("click"),expect(a.testTime).to.equal("22:15")})}),describe("when clicking the decrease minute button",function(){var b;beforeEach(function(){b=$testRegion.find(".decrease .minutes")}),it("should reduce the time by 15 minutes",function(){b.trigger("click"),expect(a.testTime).to.equal("21:45")})})})}),describe("timeSlot directive",function(){var a;beforeEach(function(){a=$rootScope.$new(),a.weekdays=["monday","tuesday","wednesday"],a.item={firstName:"NEWEST",lastName:"USER",email:"aaron.smith@example.com",phone:"021 99 88 77",workingHours:{monday:{isAvailable:!0,startTime:"11:00",finishTime:"11:00"},tuesday:{isAvailable:!1},wednesday:{isAvailable:!0}}},createDirective(a,"<div><time-slot></time-slot></div>")}),it("should have as many entries as days",function(){var b=$testRegion.find(".weekday");expect(b.length).to.equal(_.size(a.item.workingHours))}),describe("when a day is available",function(){it("should enable the time spinner",function(){var a=$testRegion.find(".weekday").first();expect(a.find("time-range-picker").attr("disabled")).to.equal(void 0)})}),describe("when a day is unavailable",function(){it("should disable the time spinner",function(){var a=$testRegion.find(".weekday:nth-child(2)");expect(a.find("time-range-picker").hasClass("ng-hide")).to.be["true"]})}),describe("when clicking on the toggle available switch",function(){var b;beforeEach(function(){var a=$testRegion.find(".weekday").first();b=a.find("button"),b.trigger("click")}),it("should set isAvailable to false",function(){expect(a.item.workingHours.monday.isAvailable).to.be["false"]}),it("the day should be valid",function(){var a=$testRegion.find("time-range-picker").first();expect(a.hasClass("ng-invalid")).to.be["false"]}),describe("when clicking on the toggle available switch again",function(){it("should set isAvailable to true",function(){b.trigger("click"),expect(a.item.workingHours.monday.isAvailable).to.be["true"]}),it("the day should be invalid",function(){b.trigger("click");var a=$testRegion.find("time-range-picker").first();expect(a.hasClass("ng-invalid")).to.be["true"]})})}),describe("time validation",function(){describe("when times are the same",function(){it("the day should be invalid",function(){var a=$testRegion.find("time-range-picker").first();expect(a.hasClass("ng-invalid")).to.be["true"]})}),describe("when there is negative time between the times",function(){it("the day should be invalid",function(){a.item.workingHours.monday.startTime="12:00",a.$apply();var b=$testRegion.find("time-range-picker").first();expect(b.hasClass("ng-invalid")).to.be["true"]})}),describe("when there is ample time between times",function(){it("the day should be vaild",function(){a.item.workingHours.monday.startTime="9:00",a.$apply();var b=$testRegion.find("time-range-picker").first();expect(b.hasClass("ng-invalid")).to.be["false"]})})})});