angular.module("app.controllers",[]).controller("appCtrl",["$rootScope","$timeout",function(a,b){a.addAlert=function(c){var d=!0;_.forEach(a.alerts,function(a){return a.message===c.message?d=!1:void 0}),d&&(a.alerts.push(c),"success"===c.type&&b(function(){_.pull(a.alerts,c)},3e3))},a.closeAlert=function(b){a.alerts.splice(b,1)},a.removeAlerts=function(){a.alerts=[]}}]),angular.module("app.directives",[]).directive("activityIndicator",function(){return{replace:!0,templateUrl:"app/partials/activityIndicator.html"}}),angular.module("app",["ngAnimate","ui.bootstrap","ui.router","jm.i18next","app.controllers","app.services","app.directives","businessSetup","scheduling","ngActivityIndicator"]).config(["$stateProvider",function(a){a.state("home",{url:"/"})}]).config(["$i18nextProvider",function(a){a.options={lng:"en",fallbackLng:"en",ns:{namespaces:["app","businessSetup","scheduling"],defaultNs:"app"},resGetPath:"i18n/__lng__.json",defaultLoadingValue:""}}]).run(["$rootScope","$state","$stateParams","editableOptions",function(a,b,c,d){a.$state=c,a.$stateParams=b,a.alerts=[],d.theme="bs3"}]),angular.module("app.services",[]).factory("coachSeekAPIService",["$http","$q","$timeout",function(a,b,c){var d={};return d.getBusiness=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve({})},_.random(500,600)),this.deferred.promise},d.saveBusiness=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve([])},_.random(500,600)),this.deferred.promise},d.createBusiness=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve({business:{name:"West Coast Toast"},admin:{firstName:"Toast",lastName:"Master",email:"toastmaster@westcoasttoast.com",password:"password"}})},_.random(500,600)),this.deferred.promise},d.getLocations=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve([])},_.random(500,600)),this.deferred.promise},d.createLocation=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve({businessId:"8786bcd0-3b14-4f7b-92db-198527a5b949",id:null,name:"THE LAB",address:"1800 taylor ave n",city:"Seattle",state:"WA",country:"USA"})},_.random(500,800)),this.deferred.promise},d.saveLocation=function(){var a=b.defer();return a.resolve("DATA"),a.promise},d.getServices=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve([{businessId:"8786bcd0-3b14-4f7b-92db-198527a5b949",id:_.uniqueId("service_"),name:"Toast Making w",description:"I show you how to make goddamn toast, son.",timing:{duration:"0:30"},booking:{studentCapacity:8},presentation:{color:"blue"},repititon:{sessionCount:4,repeatFrequency:"w"},pricing:{sessionPrice:15,coursePrice:150}},{businessId:"8786bcd0-3b14-4f7b-92db-198527a5b949",id:_.uniqueId("service_"),name:"Toast Roasting d",description:"I show you how to roast goddamn toast, son.",timing:{duration:"1:45"},booking:{studentCapacity:8},presentation:{color:"green"},repititon:{sessionCount:4,repeatFrequency:"d"},pricing:{sessionPrice:15,coursePrice:150}},{businessId:"8786bcd0-3b14-4f7b-92db-198527a5b949",id:_.uniqueId("service_"),name:"Boasting",description:"I show you how to boast, son.",timing:{duration:"4:15"},booking:{studentCapacity:8},presentation:{color:"purple"},repititon:{sessionCount:-1,repeatFrequency:-1},pricing:{sessionPrice:15,coursePrice:150}},{businessId:"8786bcd0-3b14-4f7b-92db-198527a5b949",id:_.uniqueId("service_"),name:"Duding",description:"I teach you how to be a dude.",timing:{duration:"2:15"},booking:{studentCapacity:8},presentation:{color:"orange"},repititon:{sessionCount:null,repeatFrequency:null},pricing:{sessionPrice:15,coursePrice:150}}])},_.random(500,1600)),this.deferred.promise},d.createService=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve({businessId:"8786bcd0-3b14-4f7b-92db-198527a5b949",id:null,name:"Toast Making",description:"I show you how to make goddamn toast, son.",timing:{duration:"0:15"},booking:{studentCapacity:8},presentation:{color:"blue"},repititon:{sessionCount:12,repeatFrequency:"w"},pricing:{sessionPrice:15,coursePrice:150}})},_.random(500,800)),this.deferred.promise},d.saveService=function(){var a=b.defer();return a.resolve("DATA"),a.promise},d.getCoaches=function(){this.deferred=b.defer();var a=this;return c(function(){a.deferred.resolve({})},_.random(500,1500)),this.deferred.promise},d.saveCoach=function(){var a=b.defer();return a.resolve("DATA"),a.promise},d.createCoach=function(){var a=b.defer();return a.resolve({businessId:"8786bcd0-3b14-4f7b-92db-198527a5b949",id:null,firstName:"Toast",lastName:"Apprentice #1",email:"apprentice@westcoasttoast.com",phone:"021 99 88 77",workingHours:{monday:{isAvailable:!0,startTime:"9:00",finishTime:"17:00"},tuesday:{isAvailable:!0,startTime:"9:00",finishTime:"17:00"},wednesday:{isAvailable:!0,startTime:"9:00",finishTime:"17:00"},thursday:{isAvailable:!0,startTime:"9:00",finishTime:"17:00"},friday:{isAvailable:!0,startTime:"9:00",finishTime:"17:00"},saturday:{isAvailable:!1,startTime:"9:00",finishTime:"17:00"},sunday:{isAvailable:!1,startTime:"9:00",finishTime:"17:00"}}}),a.promise},d}]),angular.module("businessSetup.controllers",[]).controller("businessCtrl",["$scope","CRUDService",function(a,b){a.editItem=function(b){_.pull(a.itemList,b),a.itemCopy=angular.copy(b),a.item=b},a.createItem=function(){b.create("createBusiness",a)},a.saveItem=function(c){var d=b.validateForm(a);d&&b.update("saveBusiness",a,c)},a.cancelEdit=function(){b.cancelEdit(a)},a.$on("$stateChangeStart",function(b,c){_.contains(["businessSetup.locations","businessSetup.coachList","businessSetup.services"],c.name)&&(!a.itemList||a.itemList.length<=0)&&(b.preventDefault(),a.addAlert({type:"warning",message:"businessSetup:add-business-warning"}))}),b.get("getBusiness",a)}]).controller("locationsCtrl",["$scope","$http","CRUDService",function(a,b,c){a.createItem=function(){c.create("createLocation",a)},a.editItem=function(b){_.pull(a.itemList,b),a.itemCopy=angular.copy(b),a.item=b},a.saveItem=function(b){var e=c.validateForm(a);e=d(e),e&&c.update("saveLocation",a,b)},a.cancelEdit=function(){c.cancelEdit(a)};var d=function(b){var c=a.item.name,d=a.item.address;return _.find(a.itemList,{name:c,address:d})&&(a.addAlert({type:"warning",message:"businessSetup:location-already-exists"}),b=!1),b};a.$on("$stateChangeStart",function(b,c){_.contains(["businessSetup.coachList","businessSetup.services"],c.name)&&(!a.itemList||a.itemList.length<=0)&&(b.preventDefault(),a.addAlert({type:"warning",message:"businessSetup:add-location-warning"}))}),c.get("getLocations",a)}]).controller("coachesCtrl",["$scope","CRUDService",function(a,b){a.editItem=function(b){_.pull(a.itemList,b),a.itemCopy=angular.copy(b),a.item=b,a.weekdays=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]},a.createItem=function(){b.create("createCoach",a)},a.cancelEdit=function(){b.cancelEdit(a)},a.saveItem=function(d){var e=b.validateForm(a);e=c(e),e&&b.update("saveCoach",a,d)};var c=function(b){var c=a.item.firstName,d=a.item.lastName;return _.find(a.itemList,{firstName:c,lastName:d})&&(a.addAlert({type:"warning",message:"businessSetup:name-already-exists"}),b=!1),b};a.$on("$stateChangeStart",function(b,c){"businessSetup.services"===c.name&&(!a.itemList||a.itemList.length<=0)&&(b.preventDefault(),a.addAlert({type:"warning",message:"businessSetup:add-coach-warning"}))}),b.get("getCoaches",a)}]).controller("servicesCtrl",["$scope","CRUDService",function(a,b){a.createItem=function(){b.create("createService",a)},a.editItem=function(b){_.pull(a.itemList,b),a.itemCopy=angular.copy(b),a.item=b},a.saveItem=function(d){var e=b.validateForm(a);e=c(e),e&&b.update("saveService",a,d)},a.cancelEdit=function(){b.cancelEdit(a)};var c=function(b){var c=a.item.name;return _.find(a.itemList,{name:c})&&(a.addAlert({type:"warning",message:"businessSetup:service-already-exists"}),b=!1),b};a.$watch("item.repititon.repeatFrequency",function(b){(-1===b||null===b)&&(a.item.pricing.coursePrice=null)}),a.$on("$stateChangeStart",function(b,c){"businessSetup.scheduling"===c.name&&(!a.itemList||a.itemList.length<=0)&&(b.preventDefault(),a.addAlert({type:"warning",message:"businessSetup:add-services-warning"}))}),b.get("getServices",a)}]),angular.module("businessSetup.directives",[]).directive("repeatSelector",function(){var a=[{value:"w",text:"week"},{value:"d",text:"day"},{value:null,text:"once"},{value:-1,text:"forever"}];return{scope:{sessionCount:"=",repeatFrequency:"="},templateUrl:"businessSetup/partials/repeatSelector.html",link:function(b){b.frequencies=a,b.$watch("repeatFrequency",function(a){-1===a||null===a?b.sessionCount=a:(b.sessionCount<0||null===b.sessionCount)&&a&&(b.sessionCount=2)}),b.showStatus=function(){var a=_.filter(b.frequencies,{value:b.repeatFrequency});return a[0]?a[0].text:"Not set"}}}}).directive("colorPicker",function(){var a=["red","green","blue","orange","yellow"];return{scope:{currentColor:"="},templateUrl:"businessSetup/partials/colorPicker.html",link:function(b){b.colors=a,b.$watch("currentColor",function(a){b.currentColor=a})}}}).directive("timeSlot",function(){return{replace:!0,templateUrl:"businessSetup/partials/timeSlot.html"}}).directive("timePicker",function(){return{replace:!0,templateUrl:"businessSetup/partials/timePicker.html",scope:{time:"="},link:function(a){a.$watch("time",function(b){if(a.time=b,a.time){var c=a.time.split(":");a.hours=parseFloat(c[0]),a.minutes=parseFloat(c[1])}}),a.increaseHours=function(){a.hours=a.hours<23?++a.hours:0,c()},a.decreaseHours=function(){a.hours=a.hours<=0?23:--a.hours,c()},a.increaseMinutes=function(){a.minutes>=45?(a.minutes=0,a.increaseHours()):a.minutes=a.minutes+15,c()},a.decreaseMinutes=function(){a.minutes<=0?(a.minutes=45,a.decreaseHours()):a.minutes=a.minutes-15,c()};var b=function(){return a.minutes<=9?"0"+a.minutes:a.minutes},c=function(){var c=b();a.time=a.hours+":"+c}}}}).directive("timeRangePicker",function(){return{replace:!1,scope:{start:"=",finish:"=",disabled:"=ngDisabled"},templateUrl:"businessSetup/partials/timeRangePicker.html",require:"ngModel",link:function(a,b,c,d){a.$watchGroup(["start","finish","disabled"],function(a){if(a[0]&&a[1]){var b=e(a[0]),c=e(a[1]);a[2]===!0||b.hours<c.hours?d.$setValidity("timeRange",!0):(b.hours===c.hours&&b.minutes>=c.minutes||b.hours>c.hours)&&d.$setValidity("timeRange",!1)}});var e=function(a){var b=a.split(":");return a={},a.hours=parseFloat(b[0]),a.minutes=parseFloat(b[1]),a}}}}),angular.module("businessSetup",["businessSetup.controllers","businessSetup.directives","businessSetup.services"]).config(["$stateProvider",function(a){a.state("businessSetup",{url:"/business-setup",templateUrl:"businessSetup/partials/businessSetup.html"}).state("businessSetup.business",{url:"/business",views:{"list-item-view":{templateUrl:"businessSetup/partials/businessView.html",controller:"businessCtrl"}}}).state("businessSetup.locations",{url:"/locations",views:{"list-item-view":{templateUrl:"businessSetup/partials/locationsView.html",controller:"locationsCtrl"}}}).state("businessSetup.coachList",{url:"/coach-list",views:{"list-item-view":{templateUrl:"businessSetup/partials/coachesView.html",controller:"coachesCtrl"}}}).state("businessSetup.services",{url:"/services",views:{"list-item-view":{templateUrl:"businessSetup/partials/servicesView.html",controller:"servicesCtrl"}}})}]),angular.module("businessSetup.services",[]).service("CRUDService",["coachSeekAPIService","$activityIndicator",function(a,b){this.get=function(c,d){b.startAnimating(),a[c]().then(function(a){_.size(a)?d.itemList=a:(d.itemList=[],d.createItem())},function(a){d.addAlert({type:"danger",message:"businessSetup:"+a.message})})["finally"](function(){b.stopAnimating()})},this.create=function(c,d){b.startAnimating(),a[c]().then(function(a){d.newItem=!0,d.editItem(a)},function(a){d.addAlert({type:"danger",message:"businessSetup:"+a.message})})["finally"](function(){b.stopAnimating()})},this.update=function(e,f,g){b.startAnimating(),a[e]().then(function(){f.itemList.push(g),c(f),f.addAlert({type:"success",message:"businessSetup:save-success",name:g.name?g.name:d(g)})},function(a){f.addAlert({type:"danger",message:"businessSetup:"+a.message})})["finally"](function(){b.stopAnimating()})},this.cancelEdit=function(a){a.newItem||a.itemList.push(a.itemCopy),c(a)},this.validateForm=function(a){var b=a.itemForm.$valid;if(!b){var c=a.itemForm.$error;_.forEach(c,function(b,c){_.forEach(b,function(b){var d=b&&b.$name?b.$name:c;a.addAlert({type:"warning",message:"businessSetup:"+d+"-invalid"})})})}return b};var c=function(a){a.item=null,a.removeAlerts(),a.newItem=null,a.itemCopy=null},d=function(a){return a.firstName&&a.lastName?a.firstName+" "+a.lastName:a.business?a.business.name:void 0}}]),angular.module("scheduling.controllers",[]).controller("schedulingCtrl",["$scope","CRUDService",function(a,b){a.events=[],a.eventSources=[a.events],a.myCallback=function(){console.log("REVERT")},a.uiConfig={calendar:{height:500,editable:!0,droppable:!0,allDaySlot:!1,defaultView:"agendaWeek",eventDurationEditable:!1,drop:function(a){$(this).hide().css({top:0,left:0}).fadeIn(600);var b=$(this).data("service");d(a,b)},eventDrop:function(){},header:{left:"month agendaWeek agendaDay",center:"title",right:"today prev,next"},scrollTime:"08:00:00"}};var c=function(a){var b=a.split(":");return parseFloat(60*b[0])+parseFloat(b[1])},d=function(a,b){var d=b.repititon.repeatFrequency,f=(c(b.timing.duration),_.uniqueId("service_"));if(-1===d)e(f,a,b,0);else if(null===d)e(f,a,b,0);else if(d){var g=b.repititon.sessionCount;_.times(g,function(c){e(f,a,b,c)})}},e=function(b,d,e,f){var g=d.clone(),h=e.repititon.repeatFrequency,i=c(e.timing.duration),j={_id:b,title:e.name,start:moment(g.add(f,h)),end:moment(g.add(i,"minutes")),allDay:!1,color:e.presentation.color};a.events.push(j)};b.get("getServices",a)}]),angular.module("scheduling",["scheduling.controllers","ngDragDrop","ui.calendar"]).config(["$stateProvider",function(a){a.state("scheduling",{url:"/scheduling",templateUrl:"scheduling/partials/schedulingView.html",controller:"schedulingCtrl"})}]);